{
  "name": "Karooma Simple Sync",
  "version": "1.0",
  "description": "VersÃ£o simplificada para comeÃ§ar rapidamente",
  "nodes": [
    {
      "name": "â° Executar Diariamente 6h",
      "type": "n8n-nodes-base.scheduleTrigger",
      "parameters": {
        "rule": {
          "interval": [{ "field": "cronExpression", "value": "0 6 * * *" }]
        }
      }
    },
    {
      "name": "ğŸ“‹ URLs dos Produtos",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": "// âœï¸ EDITE AQUI: Liste seus produtos da Amazon\nconst produtos = [\n  'https://amzn.to/44TPsu4',  // Balance Bike Nathor\n  // 'https://amzn.to/seu-link-2',  // Adicione mais aqui\n];\n\n// âœï¸ EDITE AQUI: URL do seu Replit\nconst KAROOMA_URL = 'https://seu-projeto.replit.app';\n\nreturn produtos.map(url => ({ json: { amazonUrl: url, karoomaUrl: KAROOMA_URL } }));"
      }
    },
    {
      "name": "ğŸŒ Buscar PÃ¡gina Amazon",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "={{ $json.amazonUrl }}",
        "options": {
          "timeout": 30000,
          "headers": { "User-Agent": "Mozilla/5.0 (compatible; KaroomaBot/1.0)" }
        }
      }
    },
    {
      "name": "ğŸ“Š Extrair Dados",
      "type": "n8n-nodes-base.function", 
      "parameters": {
        "functionCode": "const html = $input.first().json.data;\nconst url = $input.first().json.amazonUrl;\n\n// Extrair tÃ­tulo\nconst titulo = (html.match(/<title[^>]*>([^<]+)<\\/title>/i) || [])[1]\n  ?.replace(' : Amazon.com.br', '').trim() || '';\n\n// Extrair preÃ§o\nconst precos = html.match(/R\\$\\s*([\\d,\\.]+)/g) || [];\nconst preco = precos[0] ? parseFloat(precos[0].replace(/[R$,]/g, '').replace('.', '')) / 100 : null;\n\n// Extrair rating\nconst rating = (html.match(/(\\d+[,\\.]\\d+)\\s*de\\s*5\\s*estrelas/i) || [])[1]\n  ?.replace(',', '.') || null;\n\n// Definir categoria baseada no tÃ­tulo\nconst categorias = {\n  familia: ['bicicleta', 'bike', 'infantil', 'crianÃ§a', 'brinquedo'],\n  casa: ['casa', 'cozinha', 'organiz', 'decoraÃ§Ã£o'],\n  autocuidado: ['beleza', 'cuidado', 'cosmÃ©tico', 'shampoo'],\n  saude: ['saÃºde', 'vitamina', 'suplemento', 'remÃ©dio'],\n  tecnologia: ['eletrÃ´nico', 'computador', 'celular', 'fone']\n};\n\nlet categoria = 'casa';\nfor (const [cat, palavras] of Object.entries(categorias)) {\n  if (palavras.some(p => titulo.toLowerCase().includes(p))) {\n    categoria = cat;\n    break;\n  }\n}\n\nreturn [{\n  json: {\n    title: titulo,\n    currentPrice: preco?.toString() || '0',\n    rating: rating,\n    category: categoria,\n    affiliateLink: url,\n    featured: parseFloat(rating) >= 4.5,\n    karoomaUrl: $input.first().json.karoomaUrl\n  }\n}];"
      }
    },
    {
      "name": "âœ… Validar Dados",
      "type": "n8n-nodes-base.if",
      "parameters": {
        "conditions": {
          "conditions": [
            { "leftValue": "={{ $json.title }}", "operator": { "type": "string", "operation": "notEmpty" }},
            { "leftValue": "={{ $json.currentPrice }}", "operator": { "type": "number", "operation": "gte" }, "rightValue": 10 }
          ],
          "combineOperation": "all"
        }
      }
    },
    {
      "name": "ğŸ”„ Sincronizar Karooma",
      "type": "n8n-nodes-base.httpRequest",
      "parameters": {
        "url": "={{ $json.karoomaUrl }}/api/automation/products/sync",
        "method": "POST",
        "sendHeaders": true,
        "headers": { "parameters": [{ "name": "Content-Type", "value": "application/json" }] },
        "sendBody": true,
        "jsonBody": "={{ JSON.stringify({ title: $json.title, currentPrice: $json.currentPrice, rating: $json.rating, category: $json.category, affiliateLink: $json.affiliateLink, featured: $json.featured, description: $json.title + '. Produto selecionado com base em avaliaÃ§Ãµes positivas na Amazon.' }) }}"
      }
    },
    {
      "name": "ğŸ“ˆ Log Resultado",
      "type": "n8n-nodes-base.function",
      "parameters": {
        "functionCode": "const dados = $input.first().json;\nconsole.log('âœ… SUCESSO:', dados.title || 'Produto');\nconsole.log('ğŸ’° PreÃ§o: R$', dados.currentPrice);\nconsole.log('â­ Rating:', dados.rating);\nconsole.log('ğŸ“‚ Categoria:', dados.category);\nreturn [{ json: { status: 'success', produto: dados.title } }];"
      }
    },
    {
      "name": "âŒ Log Erro",
      "type": "n8n-nodes-base.function", 
      "parameters": {
        "functionCode": "const dados = $input.first().json;\nconsole.log('âŒ ERRO: Dados invÃ¡lidos');\nconsole.log('TÃ­tulo:', dados.title || 'VAZIO');\nconsole.log('PreÃ§o:', dados.currentPrice || 'VAZIO');\nreturn [{ json: { status: 'error', dados } }];"
      }
    }
  ],
  "connections": {
    "â° Executar Diariamente 6h": { "main": [["ğŸ“‹ URLs dos Produtos"]] },
    "ğŸ“‹ URLs dos Produtos": { "main": [["ğŸŒ Buscar PÃ¡gina Amazon"]] },
    "ğŸŒ Buscar PÃ¡gina Amazon": { "main": [["ğŸ“Š Extrair Dados"]] },
    "ğŸ“Š Extrair Dados": { "main": [["âœ… Validar Dados"]] },
    "âœ… Validar Dados": { 
      "main": [
        ["ğŸ”„ Sincronizar Karooma"], 
        ["âŒ Log Erro"]
      ] 
    },
    "ğŸ”„ Sincronizar Karooma": { "main": [["ğŸ“ˆ Log Resultado"]] }
  }
}